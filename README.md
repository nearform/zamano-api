zamano-api
==========

Node.js API for Zamano, a mobile message aggregation service.  Allows servers to send and recieve mobile text and binary messages.

Setup
-----

To install the package, run:

  `npm install zaman-api`
  
Then call `require` with your ID and password provided by Zamano to identify your server.

  ```JavaScript
  var zamano = require('zamano-api')('ZAMANO_ID', 'ZAMANO_PASSWORD')
  ```

Usage
-----

Zamano has API methods for both sending and receiving mobile messages.

### zamano.sendMessage(opts, callback)

Sends a message to a mobile number, returning either a success object or error object with messages from Zamano's service.  Internally, this method sends a request to Zamano's HTTP API and parses the XML response into a JavaScript object.

Params:
  - `opts` (Object) 
    * `sourceMsisdn` - short code representing the tariff amount and country
    * `destinationMsisdn` - destination mobile phone number
    * `messageText` - text of the message
    * `operatorId` - The unique identifier of the Mobile Network Operator.  If unknown, set to Vodafone (1).
    * `requestId` (optional) - a reference/tag for this message
    * `sourceMsisdnTag` (optional) - the label that the message will appear to come from on end users' handsets.

  - `callback` (Function) - a function with conventional node.js `function(err, out)` signature.  If the message was a success, the `out` object will have a `responseId` tracking number generated by zamano's server.

### zamano.handleMessages(opts)

Express middleware for parsing SMS message requests from Zamano.  Use the function as middleware in a app.get('<URL>') function to authenticate the request from Zamano and add a `mobileMessage` property to the `request` object:

  ```Javascript
  app.get('/api/mo', zamano.handleMessages(), function(req, res) {
    console.dir(req.mobileMessage)
    res.end()
  })
  ```

The mobileMessage object has the following properties:
  - `username` - user's zamano id
  - `password` - user's zamano password
  - `from` - the originating mobile phone number
  - `to` - the terminating number to which the message was sent.
  - `text` - the text of the message
  - `operatorId` - The unique identifier of the Mobile Network Operator

Note: Zamano's server expects a response from the mobile originating message request.  If there is no response within 2 seconds, then the transaction will be considered failed.
